---
title:  "ë‚˜ë¬´ìœ„í‚¤ ë¤í”„ í™œìš©í•˜ê¸°"
date:   2022-06-02 14:17:40 +0900
categories: dataset
---


ì°¸ê³ : [íŒŒì´ì¬ìœ¼ë¡œ ë‚˜ë¬´ìœ„í‚¤ JSON ë¤í”„ ë°ì´í„° íŒŒì‹±í•˜ê¸°
](https://heegyukim.medium.com/%ED%8C%8C%EC%9D%B4%EC%8D%AC%EC%9C%BC%EB%A1%9C-%EB%82%98%EB%AC%B4%EC%9C%84%ED%82%A4-json-%EB%8D%A4%ED%94%84-%EB%8D%B0%EC%9D%B4%ED%84%B0-%ED%8C%8C%EC%8B%B1%ED%95%98%EA%B8%B0-8f41cee1e155)

## ëŒ€ìš©ëŸ‰ JSON ì½ê¸°

ë¤í”„ëœ [ë‚˜ë¬´ìœ„í‚¤](https://namu.wiki) ë°ì´í„° JSONì€ í•œ ì¤„ì— í•œ ë ˆì½”ë“œê°€ ì €ì¥ë˜ëŠ” `jsonl` í¬ë§·ì´ ì•„ë‹Œ í•œ ì¤„ì— ëª¨ë“  ë°ì´í„°ê°€ ë‹¤ ìˆ˜ë¡ë˜ì–´ ìˆëŠ” í˜•íƒœì´ê¸° ë•Œë¬¸ì— `readline()` ë° `json` íŒ¨í‚¤ì§€ ë“±ìœ¼ë¡œ ì½ì–´ë“¤ì´ëŠ” ë°©ë²•ìœ¼ë¡œëŠ” ì²˜ë¦¬ê°€ ë¶ˆê°€ëŠ¥í•˜ê³  ì‹¤í–‰ ë„ì¤‘ ë©”ëª¨ë¦¬ ì—ëŸ¬ ë“±ì„ ì¼ìœ¼í‚µë‹ˆë‹¤.  
(ë§ˆì°¬ê°€ì§€ ì´ìœ ë¡œ `vim` ë“±ì˜ í¸ì§‘ê¸°ë¡œ ë¯¸ë¦¬ë³´ê¸°ë„ ì–´ë µìŠµë‹ˆë‹¤.)

ë”°ë¼ì„œ line-by-line ì´ ì•„ë‹Œ ë°©ë²•ìœ¼ë¡œ ì²˜ë¦¬í•˜ëŠ” parser ë¡œ ì²˜ë¦¬í•  í•„ìš”ê°€ ìˆìœ¼ë©° `ijson` ([PyPI](https://pypi.org/project/ijson/)) ê°€ ì—¬ê¸°ì— ë¶€í•©í•©ë‹ˆë‹¤.   
`ijson` ì€ iterative í•œ parser ë¡œì„œ ë‚´ë¶€ë¥¼ ì •í™•í•˜ê²Œ ë“¤ì—¬ë‹¤ ë³´ì§€ëŠ” ì•Šì•˜ì§€ë§Œ character (í˜¹ì€ byte-sequence) ë‹¨ìœ„ë¡œ ì²˜ë¦¬í•˜ëŠ” ê²ƒìœ¼ë¡œ ìƒê°ë©ë‹ˆë‹¤.   
ì¼ë°˜ì ì¸ ë°©ë²•ìœ¼ë¡œëŠ” ì—´ë¦¬ì§€ ì¡°ì°¨ ì•ŠëŠ” ìˆ˜ GB ì´ìƒì˜ json íŒŒì¼ ë‚´ìš©ì„ ìˆœì°¨ì ìœ¼ë¡œ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

{% highlight python %}
def parse_namuwiki_json(limit = -1, debug=False):
  i = 0
  doc = {}
  with open(SOURCE_FILE) as f:
    for prefix, event, value in ijson.parse(f):

      if debug:
        print(prefix, event, value)

      if (prefix, event) in capture_values:
        doc[prefix.replace("item.", "")] = value
      if (prefix, event, value) == ("item", "end_map", None):
        yield doc
        doc = {}
        i += 1

        if limit > 0 and i >= limit:
          break
{% endhighlight %}

ìœ„ ì˜ˆì œëŠ” `parse()`  ë©”ì„œë“œë¥¼ ì´ìš©í•´ ìˆœì°¨ì ìœ¼ë¡œ íŒŒì‹±í•˜ëŠ” ì½”ë“œì…ë‹ˆë‹¤. ì´ iterator ëŠ” `prefix, event, value` ë¥¼ ê°’ìœ¼ë¡œ ë‚´ì£¼ê²Œ ë˜ë©°,   
`name: value` êµ¬ì¡°ì˜ JSON ì„ ì½ì„ ë•Œ `prefix` ëŠ” name, `value` ëŠ” ë§ ê·¸ëŒ€ë¡œ valueì— í•´ë‹¹ë˜ì£ .


ë‹¤ë§Œ iterative ì¦‰ ë©ì–´ë¦¬ë¡œ ì½ëŠ” ê²ƒì´ ì•„ë‹Œ ìˆœì°¨ì ìœ¼ë¡œ ì½ì–´ë‚˜ê°€ê¸° ë•Œë¬¸ì— hierarchical í•˜ê²Œ êµ¬ì„±ëœ JSON ì„ ì½ì„ ë•Œì—ëŠ” ì‹¤ì œ ì›í•˜ëŠ” leaf node ìª½ì˜ (ì˜ˆë¥¼ ë“¤ì–´ ê°€ì¥ ìì‹ ìª½) ì •ë³´ë¥¼ ì½ì„ ë•Œì™€ ê°™ì€ ìƒí™©ì—ì„œëŠ” ì£¼ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.   

ì´ ë•Œ í•„ìš”í•œ ê²ƒì´ `event` ë¶€ë¶„ì¸ë° í˜„ì¬ parser ê°€ ì–´ëŠ ë¶€ë¶„ì„ ì½ê³  ìˆëŠ”ì§€ë¥¼ ë‚˜íƒ€ë‚´ì£¼ê²Œ ë˜ì£ .
`map_key` ì¼ ê²½ìš°ì— ì‹¤ì œ name ì— í•´ë‹¹ë˜ëŠ” value ë¥¼ ë¬¼ê³  ìˆëŠ” ê²ƒì´ë©°, `start_map` ì´ë‚˜ `end_map`  ì€ ê°ê° JSON ê°ì²´ì˜ ì‹œì‘ê³¼ ëì— í•´ë‹¹ë©ë‹ˆë‹¤.  
ì¦‰ `end_map` ì„ í†µí•´ í•´ë‹¹ í•­ëª©ì„ ë‹¤ ì½ì—ˆìŒì„ ê°ì§€í•  ìˆ˜ ìˆìœ¼ë©° ìœ„ ì½”ë“œì—ì„œë„ ì´ë¥¼ í†µí•´ í•œ document ë¥¼ yield í•˜ëŠ”ë° ì“°ê³  ìˆìŠµë‹ˆë‹¤.

## í•„í„°ë§

í•„í„°ë§ ë¶€ë¶„ì€ ìœ„ ì°¸ì¡°ê¸€ì— ìˆëŠ” `clean_text()` ì˜ˆì œë¥¼ ê·¸ëŒ€ë¡œ ì‚¬ìš©í–ˆëŠ”ë°, wiki ë¬¸ë²•ìœ¼ë¡œ ëœ ë°ì´í„°ì˜ í…ìŠ¤íŠ¸ë§Œì„ ë„ì§‘ì–´ë‚´ëŠ” ê²ƒì´ë¼ í•  ìˆ˜ ìˆê² ìŠµë‹ˆë‹¤.

> **_ì—…ë°ì´íŠ¸:_** 2022ë…„ 6ì›” í˜„ì¬ [namu-wiki-extractor](https://github.com/jonghwanhyeon/namu-wiki-extractor) ì˜ `extract_text()` ì—ì„œ ì´ë¯¸ í•„ìš”í•œ í•„í„°ë§ì„ ëª¨ë‘ ì‹¤ì‹œí•©ë‹ˆë‹¤.    
ê²°ê³¼ì ìœ¼ë¡œ ì°¸ì¡°ê¸€ ì½”ë“œì— ìˆëŠ” ì²˜ë¦¬ê°€ ë¶ˆí•„ìš”í•˜ë©° ì˜¤íˆë ¤ ë¯¸ì£¼/ê°ì£¼ ì£¼ìœ„ì˜ í…ìŠ¤íŠ¸ê°€ ì „ë¶€ ì‚¬ë¼ì§€ëŠ” ë“±ì˜ ì˜¤ë¥˜ê°€ ë‚˜íƒ€ë‚  ìˆ˜ ìˆìœ¼ë‹ˆ `clean_text()` ë¶€ë¶„ì€ ë”°ë¡œ êµ¬í˜„í•˜ì§€ ì•Šê³  ë°”ë¡œ `extract_text()` ë¡œ ë„˜ê¸°ì‹œê¸¸ ê¶Œí•©ë‹ˆë‹¤.

## jsonl ë¡œ ë³€í™˜í•˜ê¸°

parser ë¥¼ í†µí•´ ì–»ì–´ì§„ JSON ê°ì²´ë¥¼ í•œ ì¤„ì”© ì €ì¥í•˜ë©´ ë©ë‹ˆë‹¤ ğŸ™‚

{% highlight python %}
with open(OUT_FILE, "w") as out:
  for i, doc in enumerate(parse_namuwiki_json()):
    doc['text'] = extract_text(doc['text'])

    out.write(json.dumps(doc))
    out.write("\n")

    if (i % 100) == 0:
      print("progress: ", i)
{% endhighlight %}


